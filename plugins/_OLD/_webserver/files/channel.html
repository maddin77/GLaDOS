<!DOCTYPE html>
<html>
    <head>
        <title>James • Channel</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <style type="text/css">{%css%}</style>
        <script type="text/javascript">{%jquery%}</script>
        <script type="text/javascript">{%bootstrapjs%}</script>
        <script type="text/javascript">{%dataTables%}</script>
        <script type="text/javascript">{%dtbootstrap%}</script>
        <link href="data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQEBAAICAwACAwQAAgMDAAMDAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAQAAAABQAAAAAAUAADAEAgBQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA4YcAAMADAADYGwAA/D8AAP//AAD//wAA//8AAP//AAD//wAA" rel="shortcut icon" />
    </head>
    <body>
        <div class="container">
            <div class="row main">
                <div class="navbar navbar-static-top">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li><a href="/quiz">Quiz Score</a></li>
                            <li><a href="/karma">Karma</a></li>
                            <li><a href="/user">User</a></li>
                            <li class="active"><a href="/channel">Channel</a></li>
                        </ul>
                        <ul class="nav pull-right">
                            <li><a href="" id="timer">Data cached for <strong>{%CACHEDFOR%}</strong> sec. Next update in <b>{%CACHEDFOR%}.0</b> sec.</a></li>
                        </ul>
                    </div>
                </div>
                <div class="content">
                    <div class="row-fluid">
                        <div class="span6 well">
                            <center>
                                <h1 class="name"></h1>
                            </center>
                        </div>
                        <div class="span6" id="info">
                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td width="1"><strong class="pull-right">Name</strong></td>
                                    <td class="name muted"></td>
                                </tr>
                                <tr>
                                    <td width="1"><strong class="pull-right">User</strong></td>
                                    <td class="userCount muted"></td>
                                </tr>
                                <tr>
                                    <td width="1"><strong class="pull-right">Modes</strong></td>
                                    <td class="modes"></td>
                                </tr>
                                <tr>
                                    <td width="1"><strong class="pull-right">Topic</strong></td>
                                    <td class="topic muted"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <br><br>
                    <div class="row-fluid">
                        <div class="span12">
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#messages" data-toggle="tab">Messages</a></li>
                                <li><a href="#joins" data-toggle="tab">Joins</a></li>
                                <li><a href="#parts" data-toggle="tab">Parts</a></li>
                                <li><a href="#kicks" data-toggle="tab">Kicks</a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="messages">
                                    <table class="table table-striped table-bordered table-hover table-condensed sortable"></table>
                                </div>
                                <div class="tab-pane" id="joins">
                                    <table class="table table-striped table-bordered table-hover table-condensed sortable"></table>
                                </div>
                                <div class="tab-pane" id="parts">
                                    <table class="table table-striped table-bordered table-hover table-condensed sortable"></table>
                                </div>
                                <div class="tab-pane" id="kicks">
                                    <table class="table table-striped table-bordered table-hover table-condensed sortable"></table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
        $(document).ready(function() {
            var info = {%INFO%}, chanMSg = {%CHANMSG%}, joins = {%JOINS%}, kicks = {%KICKS%}, parts = {%PARTS%}, data = "<thead><th>Nick</th><th>Time</th><th>Text</th></thead><tbody>";


            if(typeof info === "undefined") {
                $('.content').empty().html('<div class="row-fluid"><div class="alert alert-error">Channel not found.</div></div>');
                return;
            }


            for(var key in info) {
                $('.'+key).html(info[key]);
            }

            $('.modes').html( "<span class='label'>" + info.modes.split(",").join("</span> <span class='label'>") + "</span>" )

            $('title').html('James • Channel • ' + info.name);


            for(var i=0; i<chanMSg.length; i++) {
                var d = new Date(chanMSg[i].time);
                var time = d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()+", "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();
                data += "<tr>";
                data += "<td style='white-space: nowrap;'><a href='/user/" + chanMSg[i].nick + "''>" + chanMSg[i].nick + "</a></td>";
                data += "<td style='white-space: nowrap;'>" + time + "</td>";
                data += "<td>" + chanMSg[i].text + "</td>";
                data += "</tr>";
            }
            data += "</tbody>";
            $('#messages table').html(data);


            data = "<thead><th>Nick</th><th>Time</th></thead><tbody>";
            for(var i=0; i<joins.length; i++) {
                var d = new Date(joins[i].time);
                var time = d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()+", "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();
                data += "<tr>";
                data += "<td style='white-space: nowrap;'><a href='/user/" + joins[i].nick + "''>" + joins[i].nick + "</a></td>";
                data += "<td style='white-space: nowrap;'>" + time + "</td>";
                data += "</tr>";
            }
            data += "</tbody>";
            $('#joins table').html(data);

            data = "<thead><th>Nick</th><th>Time</th><th>Reason</th></thead><tbody>";
            for(var i=0; i<parts.length; i++) {
                if(parts[i].reason === null) parts[i].reason = "-";
                var d = new Date(parts[i].time);
                var time = d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()+", "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();
                data += "<tr>";
                data += "<td style='white-space: nowrap;'><a href='/user/" + parts[i].nick + "''>" + parts[i].nick + "</a></td>";
                data += "<td style='white-space: nowrap;'>" + time + "</td>";
                data += "<td>" + parts[i].reason + "</td>";
                data += "</tr>";
            }
            data += "</tbody>";
            $('#parts table').html(data);

            data = "<thead><th>Nick</th><th>By</th><th>Reason</th><th>Time</th></thead><tbody>";
            for(var i=0; i<kicks.length; i++) {
                if(kicks[i].reason === null) kicks[i].reason = "-";
                var d = new Date(kicks[i].time);
                var time = d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()+", "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();
                data += "<tr>";
                data += "<td style='white-space: nowrap;'><a href='/user/" + kicks[i].nick + "''>" + kicks[i].nick + "</a></td>";
                data += "<td style='white-space: nowrap;'><a href='/user/" + kicks[i].by + "''>" + kicks[i].by + "</a></td>";
                data += "<td>" + kicks[i].reason + "</td>";
                data += "<td style='white-space: nowrap;'>" + time + "</td>";
                data += "</tr>";
            }
            data += "</tbody>";
            $('#kicks table').html(data);

            
            $('#messages table, #joins table, #parts table, #kicks table').dataTable( {
                "sDom": "<'row-fluid'<'span6'T><'span6'f>r>t<'row-fluid'<'span6'i><'span6'p>>",
                "sPaginationType": "bootstrap",
                "oLanguage": {
                    "sEmptyTable": "No data available."
                },
            });
        });
        </script>
        <script type="text/javascript">
        $(function() {
            var time = new Date("{%TIME%}").getTime();
            var cached = {%CACHEDFOR%};
            setInterval(function() {
                var diff = ((cached*1000) - (new Date().getTime() - time)) / 1000;
                $('#timer b').html(diff.toFixed(1));
                $('#timer strong').html(cached);
                if(diff <= 0) {
                    time = new Date();
                }
            }, 100);
        });
        </script>
    </body>
</html>